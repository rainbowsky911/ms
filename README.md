## 秒杀场景演示

### 使用乐观锁来确保线程同步：

在数据库建立一个版本号的字段。



### 接口限流

``一、令牌桶限流``：使用Guava的RateLimiter实现令牌桶限流接口，代码

```java
//创建令牌桶实例
private RateLimiter rateLimiter =  RateLimiter.create(50);
```

初始化令牌桶类，每秒放行50个请求。

再使用非阻塞式获取令牌``if(!rateLimiter.tryAcquire(3, TimeUnit.SECONDS))``在没有足够令牌，等待三秒，后也没有令牌则返回抢购失败。



``二、抢购接口隐藏（加盐）``：

步骤：

- 每次点击秒杀按钮，先从服务器获取一个秒杀验证值（接口内判断是否到秒杀时间）。
- Redis以缓存用户ID和商品ID为Key，秒杀地址为Value缓存验证值
- 用户请求秒杀商品的时候，要带上秒杀验证值进行校验。



``三、单用户限制频率（单位时间内限制访问次数）``

使用redis保存每个用户访问秒杀接口次数，超过10次则不能进行抢购。



### Mysql和Redis双写一致性

实战分别有：

* 先删除缓存，再更新数据库

* 先更新数据库，再删缓存

* 先删除缓存，再更新数据库，缓存延时双删

